<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Elden Ring Fog Randomizer - Area Graph</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="styles/main.css">


</head>
<body>
    <!-- Upload Screen -->
    <div id="upload-screen">
        <h1>Fog Gate Randomizer</h1>
        <p class="subtitle">Spoiler Log Visualizer</p>

        <div id="drop-zone">
            <div class="icon">üìÇ</div>
            <p>Drop your spoiler log file here</p>
            <p class="hint">or click to browse</p>
        </div>
        <input type="file" id="file-input" accept=".txt,.log">

        <div id="demo-section">
            <p class="demo-separator">‚Äî or ‚Äî</p>
            <button id="demo-btn">Try Demo (Seed 561689827)</button>
        </div>

        <div id="error-message"></div>
    </div>

    <!-- Main UI (hidden until file loaded) -->
    <div id="main-ui">
        <div id="header">
            <div>
                <h1>Fog Gate Randomizer</h1>
                <div class="subtitle" id="seed-info">Loading...</div>
            </div>
            <div id="controls">
                <div id="mode-selector">
                    <button id="mode-spoiler" class="mode-btn" title="See the entire map">üìä Full Spoiler</button>
                    <button id="mode-explorer" class="mode-btn active" title="Discover areas as you play">üó∫Ô∏è Explorer</button>
                </div>
                <div id="search-container">
                    <input type="text" id="search" placeholder="Search area...">
                    <div id="search-dropdown"></div>
                </div>
                <div class="control-group">
                    <label title="When clicking a node, highlight the path from Chapel of Anticipation">
                        <input type="checkbox" id="show-path-from-start" checked>
                        Path from start
                    </label>
                </div>
                <button id="show-frontier-btn" style="display: none;" title="Highlight unexplored areas and their access points">üî≠ Frontier</button>
                <button id="reset-exploration-btn" style="display: none;" title="Reset exploration progress">üîÑ Reset</button>
                <button id="add-item-log-btn" style="display: none;" title="Load Item Randomizer log to see key item locations">üì¶ Add Item Log</button>
                <button id="streamer-mode-btn" style="display: none;" title="Sync with another device for streaming">üé¨ Sync</button>
                <button id="new-file-btn">Load New File</button>
            </div>
        </div>

        <div id="graph-container">
            <svg></svg>
        </div>

        <div id="tooltip">
            <span class="close-btn">&times;</span>
            <h3></h3>
            <div class="content"></div>
        </div>

        <div id="legend">
            <h4>Legend</h4>
            <div class="legend-item">
                <div class="legend-line random"></div>
                <span>Randomized Fog Gate</span>
            </div>
            <div class="legend-item">
                <div class="legend-line preexisting"></div>
                <span>Pre-existing Connection</span>
            </div>
            <div class="legend-item" id="legend-requires-item" style="display: none;">
                <div class="legend-line random" style="background: #e0a020;"></div>
                <span>Requires Key Item</span>
            </div>
            <div class="legend-item">
                <div class="legend-node start"></div>
                <span>Starting Area</span>
            </div>
            <div class="legend-item">
                <div class="legend-node normal"></div>
                <span>Normal Area</span>
            </div>
            <div class="legend-item">
                <div class="legend-node boss"></div>
                <span>Boss Arena</span>
            </div>
            <div class="legend-item">
                <div class="legend-node end"></div>
                <span>End Area</span>
            </div>
            <div class="legend-item" style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #2a2520;">
                <div class="legend-node normal"></div>
                <span>Passage (‚â§2 links)</span>
            </div>
            <div class="legend-item">
                <div class="legend-node normal hub"></div>
                <span>Interchange (3+ links)</span>
            </div>
        </div>

        <div id="stats">
            <p>Areas: <span id="area-count">0</span></p>
            <p>Interchanges: <span id="hub-count">0</span></p>
            <p>Fog Gates: <span id="random-count">0</span></p>
            <p>Pre-existing: <span id="preexisting-count">0</span></p>
        </div>

        <div id="help">
            Scroll to zoom ‚Ä¢ Drag to pan<br>
            Click node for details panel<br>
            Hover connections for travel info<br>
            Click background to close
        </div>
    </div>

    <!-- Streamer Sync Modal -->
    <div id="streamer-modal">
        <div class="streamer-modal-content">
            <button id="close-streamer-modal" class="modal-close-btn">&times;</button>
            <h3>üé¨ Streamer Sync</h3>
            <div id="streamer-not-connected">
                <p>Synchronize the graph between two devices in real-time. Perfect for streaming overlays!</p>
                <div class="streamer-modal-buttons">
                    <button id="create-session-btn" class="btn-primary">Create Session</button>
                    <button id="join-session-btn" class="btn-secondary">Join Session</button>
                </div>
                <div id="join-form" style="display: none; margin-top: 16px;">
                    <input type="text" class="session-code-input" id="join-code-input" placeholder="Enter code" maxlength="8">
                    <div class="streamer-modal-buttons">
                        <button id="join-confirm-btn" class="btn-primary">Connect</button>
                        <button id="join-cancel-btn" class="btn-secondary">Cancel</button>
                    </div>
                </div>
            </div>
            <div id="streamer-connected" style="display: none;">
                <div class="session-code-display">
                    <div class="code" id="session-code-display">----</div>
                    <p style="font-size: 0.8rem; color: #6a5a4a; margin-top: 8px;">Share this code with the other device</p>
                </div>
                <div class="viewer-url-display" style="margin-bottom: 16px;">
                    <label style="font-size: 0.8rem; color: #6a5a4a; display: block; margin-bottom: 6px;">Viewer URL (for OBS):</label>
                    <div style="display: flex; gap: 8px;">
                        <input type="text" id="viewer-url-input" readonly style="flex: 1; padding: 8px; background: #0a0908; border: 1px solid #3a3530; border-radius: 4px; color: #c9a227; font-size: 0.75rem; font-family: monospace;">
                        <button id="copy-url-btn" class="btn-secondary" style="padding: 8px 12px; white-space: nowrap;">üìã Copy</button>
                    </div>
                </div>
                <div class="sync-status" id="sync-status">
                    <span class="sync-dot"></span>
                    <span>Connected</span>
                </div>
                <div class="streamer-modal-buttons" style="margin-top: 16px;">
                    <button id="disconnect-btn" class="btn-disconnect">Disconnect</button>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="js/main.js"></script>
</body>
</html>
